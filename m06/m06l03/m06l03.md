# Занятие 3: API. OpenAI GPT

## 1. Подключение к OpenAI API

### Регистрация на платформе OpenAI

Для того чтобы начать работать с API OpenAI, необходимо создать аккаунт на официальной платформе и получить API ключ. Этот ключ будет использоваться для аутентификации ваших запросов к OpenAI и для авторизации на их сервере.

1. **Создание аккаунта**
    - Перейдите на сайт [OpenAI](https://platform.openai.com/).
    - Нажмите кнопку **Sign Up** (Зарегистрироваться), если у вас еще нет аккаунта, или **Log In** (Войти), если аккаунт уже создан.
    - Введите необходимые данные: email, пароль, а также подтвердите свою почту.
    - Возможно, потребуется указать способ оплаты, так как OpenAI использует систему оплаты за использование API.

2. **Получение API ключа**
    - После регистрации и входа в аккаунт перейдите на [страницу API](https://platform.openai.com/account/api-keys).
    - На этой странице вы найдете кнопку **Create new secret key** (Создать новый секретный ключ). Нажмите на нее.
    - После создания ключа вы получите строку, которая будет выглядеть как длинный набор символов (например, `sk-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX`). Это ваш API ключ.
    - **Важно!** Сохраните этот ключ в безопасном месте. Он нужен для подключения к API, и его нельзя показывать посторонним, так как это предоставляет доступ к вашему аккаунту.

**Рекомендация**: Для работы с API используйте переменные окружения, чтобы не хранить API ключ в коде напрямую, что повысит безопасность вашего проекта.

### Установка необходимых библиотек

Для работы с API OpenAI в Python вам потребуется установить несколько библиотек. Основная из них — это библиотека `openai`, которая позволяет легко взаимодействовать с сервисом.

1. **Установка библиотеки `openai`**
    - Откройте терминал или командную строку.
    - Используйте пакетный менеджер `pip` для установки:
    ```bash
    pip install openai
    ```
    - Библиотека `openai` автоматически установит все зависимости, необходимые для работы с API.

2. **Дополнительные библиотеки (опционально)**
    - Для более удобной работы с HTTP-запросами и ответами (если вы решите использовать другие способы взаимодействия, помимо стандартной библиотеки `openai`), можно установить дополнительные библиотеки:
        - `requests`: для работы с HTTP-запросами напрямую.
        - `dotenv`: для работы с переменными окружения (например, для безопасного хранения вашего API ключа).

    Установка этих библиотек:
    ```bash
    pip install requests python-dotenv
    ```

- **Ограничения на количество токенов**: Имейте в виду, что каждое взаимодействие с API имеет ограничения на количество токенов — как для запроса, так и для ответа. Токен — это примерно 4 байта текста, поэтому длинные запросы могут потребовать больше токенов.
- **Безопасность**: Никогда не размещайте ваш API ключ в публичных репозиториях или делитесь им с посторонними. Используйте методы скрытия ключа, такие как переменные окружения или менеджеры секретов.


## 2. Описание работы OpenAI API

### Как работает OpenAI API


OpenAI API — это набор инструментов для взаимодействия с моделями искусственного интеллекта, разработанными OpenAI, такими как GPT-3 и GPT-4. Этот API предоставляет пользователям возможность интегрировать мощные возможности ИИ в свои приложения, веб-сайты или системы. Давайте разберемся, как он работает.

### Основные принципы работы OpenAI API:

1. **Модели ИИ:**
   API предоставляет доступ к различным моделям ИИ, включая самые мощные версии GPT (например, GPT-4) и другие модели, такие как Codex, которая оптимизирована для генерации кода. Вы можете использовать эти модели для выполнения разнообразных задач, таких как обработка естественного языка, генерация текста, ответы на вопросы, анализ текста и т. д.

2. **Запросы и ответы:**
   Для того чтобы использовать API, вам нужно отправить запрос с текстом или другими данными, а API вернет вам результат в виде текста или другой информации в зависимости от задачи. Запросы могут быть достаточно простыми, например:
   - Текстовый ввод: "Как будет выглядеть искусственный интеллект через 10 лет?"
   - Код: "Напиши программу на Python, которая сортирует список чисел."

3. **Метод взаимодействия:**
   Взаимодействие с API осуществляется через HTTP-запросы, обычно в формате `POST`. Запросы содержат параметры, такие как:
   - **Модель**: указание, какую модель вы хотите использовать (например, GPT-4 или GPT-3).
   - **Входные данные**: текстовый запрос, который вы хотите обработать.
   - **Параметры генерации**: такие как максимальная длина ответа, температура (определяет креативность или случайность ответов), топ-p (параметр для сужения вероятностного пространства).

4. **Параметры генерации:**
   - **Temperature**: этот параметр контролирует "креативность" ответа. Чем выше значение (например, 0.7), тем более разнообразными и менее предсказуемыми будут ответы. Значение близкое к 0 делает модель более "детерминированной", т.е. ответы будут более точными и стабильными.
   - **Max tokens**: максимальное количество токенов (слов или частей слов), которое модель может сгенерировать в ответе.

5. **Оплата и квоты:**
   OpenAI API работает по модели оплаты за использование, которая зависит от количества обработанных токенов. Токен — это минимальная единица текста, которая может быть как частью слова, так и целым словом. Стоимость использования зависит от выбранной модели и объема данных.

6. **Управление запросами и безопасностью:**
   - **API-ключ**: для работы с API вам необходим API-ключ, который вы получаете после регистрации на платформе OpenAI. Этот ключ используется для аутентификации запросов и контроля за доступом.
   - **Безопасность и фильтрация**: OpenAI также внедряет различные механизмы фильтрации и безопасности, чтобы минимизировать вредоносные или неприемлемые запросы. Это может включать фильтрацию контента, а также проверку на токсичные или неподобающие выражения.

7. **Интеграции и SDK:**
   OpenAI предоставляет несколько библиотек и SDK, которые упрощают интеграцию с различными языками программирования. Например, для Python есть библиотека `openai`, которая предоставляет удобные методы для отправки запросов и получения ответов.

8. **Поддерживаемые задачи:**
   OpenAI API подходит для множества задач, включая:
   - Генерация текста (например, создание контента, блогов, статей).
   - Ответы на вопросы.
   - Перевод текста.
   - Поддержка диалогов.
   - Генерация кода.
   - Автоматизация обработки данных.

### Настройки и параметры запросов

API OpenAI предоставляет различные параметры, которые можно использовать для тонкой настройки поведения модели. Рассмотрим некоторые из них:

1. **`model`**: Это обязательный параметр, указывающий, какую модель использовать для обработки запроса. Выбор модели зависит от вашего случая использования, так как более мощные модели могут быть дороже в плане API запросов.

2. **`messages`**: Это основной входной текст, который подается в модель. В нем можно задавать инструкции или примеры того, что вы хотите получить от модели.

3. **`max_tokens`**: Указывает максимальное количество токенов в ответе. Один токен примерно равен 4 байтам текста. Пример: слово "программирование" состоит из 1 токена.

4. **`temperature`**: Этот параметр определяет, насколько случайными будут ответы. 
   - Если `temperature = 0`, модель будет давать наиболее вероятный ответ.
   - Если `temperature = 1`, ответы будут более разнообразными и креативными.

---

### Ограничения при работе с OpenAI API

При использовании OpenAI API важно учитывать несколько ключевых ограничений, которые могут повлиять на ваш опыт работы.

1. **Ограничение на количество токенов**
   - Одним из самых важных ограничений является количество токенов, которое можно использовать в одном запросе. Это включает как запрос, так и ответ.
   - Например, для модели `gpt-3.5-turbo` максимальное количество токенов на один запрос может быть 4096 или 8192, в зависимости от версии модели. Если вы превышаете это ограничение, запрос не будет выполнен.

2. **Лимиты на количество запросов**
   - В зависимости от вашего тарифного плана, вы можете столкнуться с лимитами на количество запросов в месяц или на секунду.
   - Если ваш план имеет лимит, превышение этого лимита может привести к блокировке запросов или дополнительным расходам.

3. **Платные тарифы**
   - OpenAI API использует модель оплаты по факту использования. Цена зависит от выбранной модели и объема использованных токенов.
   - Например, модели GPT-3.5 обычно дешевле, чем GPT-4. Для работы с большим количеством данных следует учитывать стоимость.

4. **Ограничения на типы запросов**
   - OpenAI может ограничивать доступ к определенным функциям API в зависимости от политики безопасности или типа использования. Например, для некоторых задач (генерация вредоносного контента или спама) могут быть введены ограничения.

5. **Ожидание ответа**
   - Время ожидания ответа может зависеть от сложности задачи и загруженности серверов. Для сложных запросов модель может потребовать больше времени для генерации текста, что следует учитывать при проектировании приложений.



## Токены 
**Токены** — это базовые единицы текста, которые использует модель искусственного интеллекта (ИИ) для обработки и генерации языка. В контексте OpenAI API и других современных языковых моделей, токены — это не обязательно слова или символы, а могут быть частями слов, целыми словами, а иногда даже символами или пробелами.

### Что такое токен?

Токен в ИИ моделях — это минимальная единица текста, с которой модель работает. Например, слово "кот" может быть одним токеном, но более длинные слова или фразы могут быть разделены на несколько токенов.

### Примеры токенов:

1. **Слова**: Простые слова могут быть отдельными токенами.
   - Пример: слово "кот" — это один токен.
   
2. **Части слов**: Длинные или редкие слова могут быть разделены на несколько токенов.
   - Пример: слово "невероятно" может быть разбито на два токена: "невер" и "оятно".

3. **Пунктуация**: Запятые, точки и другие знаки препинания тоже могут быть отдельными токенами.
   - Пример: "Привет, как дела?" будет разбито на токены: "Привет", ",", "как", "дела", "?".

4. **Числа и символы**: Числа и специальные символы, такие как "@", "#", "%", также могут быть отдельными токенами.
   - Пример: "12345" — это один токен, но "12 345" может быть разбито на два токена.

### Почему важны токены в OpenAI API?

1. **Ограничения по токенам**:
   В OpenAI API есть лимит на количество токенов, которые могут быть использованы в одном запросе. Этот лимит включает как входные данные (вопрос или текст, который вы отправляете в запросе), так и выходные данные (текст, который модель генерирует в ответ). Например, если ваша модель поддерживает 4096 токенов, то это означает, что суммарное количество токенов для входных и выходных данных не должно превышать 4096.

2. **Стоимость запросов**:
   OpenAI API взимает плату за использование, которая зависит от количества обработанных токенов. Это значит, что чем больше токенов в вашем запросе (входных и выходных данных), тем выше будет стоимость. Например, обработка короткого запроса с малым количеством токенов будет стоить дешевле, чем запрос с длинным текстом.

### Пример расчета токенов

Допустим, вы отправили следующий текст:

> "Привет, как дела?"

Этот текст может быть разбит на токены следующим образом:

- "Привет" — один токен
- "," — один токен
- "как" — один токен
- "дела" — один токен
- "?" — один токен

Итого: 5 токенов.

Если вы попросите модель ответить на этот запрос с объяснением, как работает OpenAI API, то ответ может быть более длинным и тоже будет содержать несколько токенов. Например, фраза "OpenAI API использует модели GPT для генерации текста" может быть разбита на следующие токены:

- "OpenAI" — один токен
- "API" — один токен
- "использует" — один токен
- "модели" — один токен
- "GPT" — один токен
- "для" — один токен
- "генерации" — один токен
- "текста" — один токен

Итого: 8 токенов.

Если вы задаете сложные вопросы или получаете длинные ответы, количество токенов будет расти, что важно учитывать при планировании использования API и расчетах стоимости.

### Почему модели используют токены, а не слова?

Модели, такие как GPT, не работают напрямую с текстами на уровне слов или предложений. Вместо этого они используют токены, потому что это позволяет гибче и эффективнее обрабатывать текст. Например:

- Модели могут эффективно работать с редкими словами, разбивая их на части.
- Токенизация помогает обрабатывать различные языки, где слова могут быть составлены из множества частей (например, в таких языках как финский или турецкий).
- Это также упрощает обработку символов, пробелов и пунктуации.

## Официальный гайд из документации (quickstart)
Quickstart: https://platform.openai.com/docs/quickstart


## Другие ссылки
Pricing: https://openai.com/chatgpt/pricing/  
Разбиение на токены: https://platform.openai.com/tokenizer  
Limits: https://platform.openai.com/settings/organization/limits  
Api keys: https://platform.openai.com/settings/organization/api-keys  
